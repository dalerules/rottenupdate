<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Rotten Apple List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f4f0;
            color: #2c2f33;
        }
        h1, h2, h3 {
            font-family: 'Roboto Slab', serif;
        }
        .container-padding {
            padding: 1.5rem;
        }
        @media (min-width: 640px) {
            .container-padding {
                padding: 2.5rem;
            }
        }
    </style>
</head>
<body class="bg-[#f8f4f0] flex flex-col items-center antialiased">

    <div class="w-full max-w-6xl bg-white shadow-xl rounded-2xl my-8 container-padding">
        
        <!-- Header Section -->
        <header class="text-center mb-12">
            <div class="flex flex-col items-center justify-center space-y-4 mb-4">
                <img src="https://storage.googleapis.com/gweb-uniblog-publish-prod/images/Google-Bard-logo.original.png" alt="The Bad Apple List Logo" class="w-full max-w-xl">
            </div>
            <h1 class="text-4xl sm:text-5xl font-bold text-red-700">The Rotten Apple List</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                A curated guide to Apple products with a history of common problems, helping you make a smarter purchase.
            </p>
        </header>

        <!-- Featured Product Section -->
        <section id="featured-product" class="bg-red-50 border-4 border-red-200 rounded-xl p-6 sm:p-8 mb-8 shadow-inner">
            <div class="flex flex-col sm:flex-row items-center sm:space-x-8">
                <div class="flex-shrink-0 w-full sm:w-1/3 mb-4 sm:mb-0">
                    <img src="https://placehold.co/400x300/e5e7eb/4b5563?text=Power+Mac+G4+Cube" alt="Power Mac G4 Cube" class="rounded-lg shadow-lg w-full h-auto object-cover">
                </div>
                <div class="flex-grow text-center sm:text-left">
                    <h2 class="text-2xl sm:text-3xl font-bold text-red-700 mb-2">Featured Mac to Avoid: The Power Mac G4 Cube</h2>
                    <p class="text-gray-700 leading-relaxed text-sm sm:text-base">
                        Released in 2000, the G4 Cube was praised for its beautiful, radical design but was plagued by fundamental flaws. Its "floating" polycarbonate case was prone to developing stress cracks, and its fanless design led to overheating issues and thermal throttling, which significantly impacted performance.
                    </p>
                    <div class="mt-4 flex items-center justify-center sm:justify-start">
                        <span class="text-lg font-bold text-red-700">Rotten Rating:</span>
                        <div class="ml-2 px-3 py-1 bg-red-700 text-white rounded-full font-bold shadow-md text-lg">5/5</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Search Bar Section -->
        <section id="search-section" class="mb-8">
            <div class="relative w-full">
                <input type="text" id="product-search" placeholder="Search for a product..." class="w-full pl-10 pr-4 py-2 rounded-full border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-colors duration-300">
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>
            </div>
        </section>

        <!-- Product List Section -->
        <section id="product-list" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Problematic Product Archive</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- 2016-2019 MacBook Pro with Butterfly Keyboard -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=MacBook+Pro" alt="MacBook Pro" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">MacBook Pro (2016-2019)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-700 text-white rounded-full font-bold text-sm">5/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        These models are notorious for their butterfly keyboard, a design that was prone to failure from a single piece of dust. Keys would become unresponsive or get stuck, leading to expensive repairs. The design was eventually abandoned by Apple.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Butterfly keyboard failure, screen flex cable problems.**
                    </p>
                </div>

                <!-- 2013-2015 Retina MacBook Pro with GPU Issues -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=MacBook+Pro" alt="MacBook Pro" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">Retina MacBook Pro (2013-2015)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-500 text-white rounded-full font-bold text-sm">4/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        While revolutionary for their displays, these laptops were known for GPU issues. The dedicated graphics cards in some models would fail, causing screen glitches and crashes.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **GPU failure, display glitches, battery swelling.**
                    </p>
                </div>
                
                <!-- 2011 MacBook Pro with AMD GPU -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=MacBook+Pro" alt="MacBook Pro" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">MacBook Pro (2011)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-700 text-white rounded-full font-bold text-sm">5/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        The 2011 MacBook Pro is widely considered one of Apple's most problematic laptops due to a high rate of graphics card failures. Many units suffered from solder issues on the AMD GPU, leading to system instability and eventual unrecoverable failure.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Graphics card failure, kernel panics.**
                    </p>
                </div>

                <!-- Original MacBook Air (2008) -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=MacBook+Air" alt="MacBook Air" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">MacBook Air (2008)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-yellow-500 text-white rounded-full font-bold text-sm">3/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        The original MacBook Air was a groundbreaking design but suffered from poor performance and a non-upgradable battery. Its slow processor and thermal limitations made it difficult to use for anything beyond basic tasks.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Overheating, slow performance, non-removable battery.**
                    </p>
                </div>

                <!-- iPhone 4 -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=iPhone+4" alt="iPhone 4" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">iPhone 4</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-700 text-white rounded-full font-bold text-sm">5/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        The iPhone 4 was praised for its new glass design but was infamous for "Antennagate," a design flaw where holding the phone a certain way would cause a significant drop in cellular signal.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Antennagate (signal loss), glass fragility.**
                    </p>
                </div>

                <!-- iPhone 6 Plus -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=iPhone+6+Plus" alt="iPhone 6 Plus" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">iPhone 6 Plus</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-500 text-white rounded-full font-bold text-sm">4/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        The larger, thinner aluminum body of the iPhone 6 Plus was susceptible to bending under pressure, which became a widely publicized issue known as "Bendgate." The constant flexing could also lead to a hardware failure called "Touch Disease."
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Chassis bending, "Touch Disease" (touch screen failure).**
                    </p>
                </div>

                <!-- iPhone 11 -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=iPhone+11" alt="iPhone 11" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">iPhone 11</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-yellow-500 text-white rounded-full font-bold text-sm">2/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        A small percentage of iPhone 11 units manufactured between November 2019 and May 2020 experienced a display module issue that caused the screen to become unresponsive to touch. Apple launched a service program to replace the faulty screens.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Unresponsive touch screen.**
                    </p>
                </div>

                <!-- iPhone 12 / 12 Pro -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=iPhone+12" alt="iPhone 12" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">iPhone 12 / 12 Pro</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-yellow-500 text-white rounded-full font-bold text-sm">2/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        A limited number of iPhone 12 and iPhone 12 Pro models had a speaker receiver that could fail, causing a loss of sound from the earpiece during phone calls. Apple initiated a service program to fix this issue as well.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **No sound from receiver, audio failure during calls.**
                    </p>
                </div>

                <!-- Mac mini (2018-2020) -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=Mac+mini" alt="Mac mini" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">Mac mini (2018-2020)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-yellow-500 text-white rounded-full font-bold text-sm">2/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        This generation of Mac mini, particularly the 2018 model, was plagued by persistent Wi-Fi and Bluetooth interference issues. The problem was most prominent when using 2.4 GHz peripherals, often causing poor network performance and connection drops.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Bluetooth/Wi-Fi interference.**
                    </p>
                </div>

                <!-- M1 MacBook Air/Pro (2020) -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=M1+MacBook" alt="M1 MacBook" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">M1 MacBook Air/Pro (2020)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-yellow-500 text-white rounded-full font-bold text-sm">2/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        While generally reliable, a small number of M1 MacBook users reported that their displays developed cracks, seemingly without any physical damage. This issue is believed to be caused by pressure from small debris trapped between the screen and keyboard when the lid is closed.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Screen cracking.**
                    </p>
                </div>
                
                <!-- AirPods Max -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=AirPods+Max" alt="AirPods Max" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">AirPods Max</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-500 text-white rounded-full font-bold text-sm">4/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        Despite their premium price and sound quality, some users have reported condensation forming inside the earcups after prolonged use. This moisture can damage the internal components and is a significant concern for a high-end audio product.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Condensation in earcups, battery drain.**
                    </p>
                </div>
                
                <!-- Apple Pencil (1st Gen) -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=Apple+Pencil" alt="Apple Pencil" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">Apple Pencil (1st Gen)</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-yellow-500 text-white rounded-full font-bold text-sm">3/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        While a great creative tool, the original Apple Pencil's charging method was a major design blunder. Plugging it directly into the iPad's Lightning port left it vulnerable to snapping off and felt awkward.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Awkward charging, easy to lose cap.**
                    </p>
                </div>

                <!-- AirPower -->
                <div class="product-card bg-gray-50 border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow duration-300">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="https://placehold.co/128x128/d1d5db/374151?text=AirPower" alt="AirPower" class="rounded-full shadow-md">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold text-gray-800">AirPower</h3>
                            <div class="mt-1 flex items-center">
                                <span class="text-sm font-bold text-red-700">Rotten Rating:</span>
                                <div class="ml-2 px-2 py-0.5 bg-red-700 text-white rounded-full font-bold text-sm">5/5</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-700 leading-relaxed text-sm">
                        Announced in 2017, this wireless charging mat was designed to charge an iPhone, Apple Watch, and AirPods simultaneously regardless of placement. However, it was canceled in 2019 due to major technical challenges with heat management and interference, making it a spectacular failure.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-2 text-sm font-semibold">
                        Common issues: **Never released due to major technical flaws.**
                    </p>
                </div>
            </div>
        </section>

        <!-- Community Report Section -->
        <section id="community-reports" class="bg-gray-100 rounded-xl p-6 sm:p-8 shadow-inner mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Community Reports</h2>
            <p class="text-center text-gray-600 mb-6">Share your own experience with a problematic Apple product!</p>

            <!-- Report Submission Form -->
            <form id="report-form" class="space-y-4">
                <div>
                    <label for="report-model" class="block text-sm font-medium text-gray-700">Product Model</label>
                    <input type="text" id="report-model" required placeholder="e.g., MacBook Pro (2016)"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                </div>
                <div>
                    <label for="report-experience" class="block text-sm font-medium text-gray-700">Your Experience</label>
                    <textarea id="report-experience" rows="4" required placeholder="Describe the issue you faced..."
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500"></textarea>
                </div>
                <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-300">
                    Submit Report
                </button>
            </form>
            <div id="status-message" class="text-center mt-4 hidden"></div>

            <!-- Reports Display -->
            <div class="mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Submitted Reports</h3>
                <div id="reports-container" class="space-y-6">
                    <div id="loading-message" class="text-center text-gray-500">Loading community reports...</div>
                    <div id="no-reports-message" class="text-center text-gray-500 hidden">No reports have been submitted yet. Be the first to share your experience!</div>
                </div>
            </div>
        </section>

        <!-- Disclaimer -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>&copy; 2025 The Rotten Apple List. All information is for educational purposes and is based on common user complaints and historical data.</p>
        </footer>

    </div>
    
    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, where, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // Global variables for Firebase configuration
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Community Report data to be added to the database on first run
        const initialReports = [
            { model: "Apple Watch Series 5", experience: "My screen cracked after a very minor bump. This seems to be a widespread issue with this model.", timestamp: new Date(2025, 8, 24, 20, 40).getTime(), userId: "12345-abcde" },
            { model: "AirPods Pro (1st Gen)", experience: "After a few months, I started getting a static-like crackling sound in one of the earbuds. It's really distracting.", timestamp: new Date(2025, 8, 23, 11, 15).getTime(), userId: "fghij-67890" },
            { model: "Magic Mouse 2", experience: "The charging port placement is absolutely ridiculous. You can't use it while it's charging, which is a major design flaw.", timestamp: new Date(2025, 8, 22, 15, 30).getTime(), userId: "klmno-12345" },
            { model: "iMac G5", experience: "This thing was a beautiful machine, but it had major capacitor issues. Mine failed after just a couple of years, and it wouldn't even turn on.", timestamp: new Date(2025, 8, 21, 9, 0).getTime(), userId: "pqrst-67890" },
            { model: "Apple USB-C Digital AV Multiport Adapter", experience: "It gets extremely hot when I use it to connect my laptop to a monitor and also charge. It's a fire hazard waiting to happen.", timestamp: new Date(2025, 8, 20, 17, 0).getTime(), userId: "uvwxyz-12345" }
        ];

        // --- Community Report Logic ---
        const reportsContainer = document.getElementById('reports-container');
        const reportForm = document.getElementById('report-form');
        const loadingMessage = document.getElementById('loading-message');
        const noReportsMessage = document.getElementById('no-reports-message');
        const statusMessage = document.getElementById('status-message');

        let db;
        let auth;
        let userId;

        /**
         * Renders a single report card in the reports container.
         * @param {object} report - The report data.
         */
        function renderReport(report) {
            const reportDiv = document.createElement('div');
            reportDiv.classList.add('bg-white', 'p-4', 'rounded-lg', 'shadow', 'dynamic-report');
            
            const timestamp = report.timestamp ? new Date(report.timestamp.seconds * 1000).toLocaleString() : 'Just now';

            reportDiv.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-bold text-lg text-gray-800">${report.model}</h4>
                    <span class="text-xs text-gray-500">${timestamp}</span>
                </div>
                <p class="text-gray-700 text-sm">${report.experience}</p>
                <div class="text-xs text-gray-400 mt-2">Submitted by User ID: ${report.userId}</div>
            `;
            reportsContainer.appendChild(reportDiv);
        }

        /**
         * Adds the initial fake reports to the Firestore database if they don't already exist.
         */
        async function seedInitialReports() {
            const reportsCollection = collection(db, `artifacts/${appId}/public/data/reports`);
            const q = query(reportsCollection, where('isInitial', '==', true));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                console.log("Seeding initial reports to Firestore...");
                for (const report of initialReports) {
                    await addDoc(reportsCollection, { ...report, isInitial: true, timestamp: serverTimestamp() });
                }
            }
        }

        /**
         * Initializes Firebase and authenticates the user.
         */
        const initFirebase = async () => {
            try {
                setLogLevel('debug');
                const app = initializeApp(firebaseConfig, 'rotten-apple-app');
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log(`User authenticated with UID: ${userId}`);
                        // Add initial reports on first load, then start listening
                        await seedInitialReports();
                        startReportListener();
                    } else {
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            console.error("Firebase Auth Error:", error);
                        }
                    }
                });
            } catch (error) {
                console.error("Firebase Init Error:", error);
            }
        };

        /**
         * Listens for real-time changes to the community reports collection.
         */
        const startReportListener = () => {
            if (!db) return;
            
            const reportsQuery = query(collection(db, `artifacts/${appId}/public/data/reports`));

            onSnapshot(reportsQuery, (snapshot) => {
                loadingMessage.classList.add('hidden');
                reportsContainer.innerHTML = ''; // Clear existing reports

                const reports = [];
                snapshot.forEach(doc => {
                    const reportData = doc.data();
                    reports.push(reportData);
                });

                // Sort reports by timestamp in descending order on the client side
                reports.sort((a, b) => {
                    const timestampA = a.timestamp?.seconds || 0;
                    const timestampB = b.timestamp?.seconds || 0;
                    return timestampB - timestampA;
                });
                
                if (reports.length === 0) {
                    noReportsMessage.classList.remove('hidden');
                } else {
                    noReportsMessage.classList.add('hidden');
                    reports.forEach(report => {
                        renderReport(report);
                    });
                }
            });
        };

        // Form submission handler
        reportForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!db || !userId) {
                console.error("Firebase not initialized or user not authenticated.");
                return;
            }

            const modelInput = document.getElementById('report-model');
            const experienceInput = document.getElementById('report-experience');

            const model = modelInput.value;
            const experience = experienceInput.value;

            if (!model || !experience) {
                statusMessage.textContent = 'Please fill out all fields.';
                statusMessage.classList.remove('hidden');
                statusMessage.classList.add('text-red-500');
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/reports`), {
                    model: model,
                    experience: experience,
                    timestamp: serverTimestamp(),
                    userId: userId 
                });
                
                statusMessage.textContent = 'Report submitted successfully!';
                statusMessage.classList.remove('hidden', 'text-red-500');
                statusMessage.classList.add('text-green-500');

                // Clear the form
                reportForm.reset();

                setTimeout(() => {
                    statusMessage.classList.add('hidden');
                }, 3000);

            } catch (e) {
                console.error("Error adding document: ", e);
                statusMessage.textContent = 'Error submitting report. Please try again.';
                statusMessage.classList.remove('hidden');
                statusMessage.classList.add('text-red-500');
            }
        });

        // Search bar logic
        const searchInput = document.getElementById('product-search');
        const productCards = document.querySelectorAll('.product-card');

        searchInput.addEventListener('input', (event) => {
            const searchText = event.target.value.toLowerCase();
            productCards.forEach(card => {
                const cardText = card.textContent.toLowerCase();
                if (cardText.includes(searchText)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        });

        // Initialize Firebase on window load
        window.onload = initFirebase;
    </script>

</body>
</html>